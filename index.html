<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHARK RNG | Abyssal Hunter</title>
    <style>
        :root {
            --bg: #01060f;
            --accent: #00f2ff;
            --panel: rgba(0, 15, 30, 0.95);
            --c-COMMON: #a0a0a0; --c-UNCOMMON: #4caf50; --c-RARE: #2196f3;
            --c-EPIC: #9c27b0; --c-LEGENDARY: #ffc107; --c-ABYSSAL: #ff3d00;
            --c-SUNKEN: #00ffcc; --c-PREHISTORIC: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            background: var(--bg); color: white;
            font-family: 'Segoe UI', sans-serif; overflow: hidden; user-select: none;
        }

        .overlay { position: fixed; inset: 0; background: #000; z-index: 4000; display: none; flex-direction: column; padding: 40px; }

        /* --- LOGIN --- */
        #start-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(circle, #001a2e 0%, #01060f 100%); }
        .login-box { background: rgba(0, 242, 255, 0.05); padding: 30px; border-radius: 20px; border: 1px solid var(--accent); text-align: center; }
        input { display: block; margin: 10px auto; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #000; color: white; width: 220px; text-align: center; }

        /* --- SHARK ENGINE --- */
        #shark-container { margin-top: 50px; }
        #shark-engine { position: relative; width: 300px; height: 120px; display: flex; justify-content: center; align-items: center; animation: global-swim 4s infinite ease-in-out; margin: 0 auto; }
        .shark-part { position: absolute; background: var(--accent); box-shadow: 0 0 20px var(--accent); }
        .shark-body { width: 130px; height: 55px; border-radius: 50% 50% 40% 40%; left: 85px; }
        .shark-fin { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 45px solid var(--accent); top: -30px; left: 125px; }
        .shark-tail { width: 0; height: 0; border-top: 30px solid transparent; border-bottom: 30px solid transparent; border-left: 45px solid var(--accent); left: 50px; animation: tail-wag 0.6s infinite ease-in-out; }
        
        @keyframes global-swim { 0%, 100% { transform: translateX(-20px); } 50% { transform: translateX(20px); } }
        @keyframes tail-wag { 0%, 100% { transform: rotateY(0deg); } 50% { transform: rotateY(45deg); } }
        .fast-swim { animation-duration: 0.15s !important; }

        /* --- UI --- */
        .side-panel { position: absolute; top: 80px; bottom: 40px; width: 280px; background: var(--panel); border: 1px solid rgba(0, 242, 255, 0.2); border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        #inventory-panel { left: 20px; }
        #perks-panel { right: 20px; }
        .p-content { flex:1; overflow-y: auto; padding: 15px; }
        .btn { padding: 10px 20px; cursor: pointer; border-radius: 8px; border: 1px solid var(--accent); background: transparent; color: white; font-weight: bold; margin: 5px; }
        #roll-btn { padding: 25px 80px; font-size: 1.6rem; border-radius: 60px; background: #fff; color: #000; font-weight: 900; border: none; box-shadow: 0 0 30px var(--accent); cursor: pointer; }
        .g-card { background: rgba(255,255,255,0.03); border: 1px solid #222; border-radius: 12px; padding: 10px; text-align: center; }
        .g-card.locked { opacity: 0.15; filter: grayscale(1); }

        /* --- CATCH REVEAL --- */
        #reveal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; display: none; flex-direction: column; justify-content: center; align-items: center; }
        #rev-icon { font-size: 120px; }
        .prehistoric-glow { filter: drop-shadow(0 0 40px #fff); animation: p-glow 1s infinite alternate; }
        @keyframes p-glow { from { filter: drop-shadow(0 0 20px #fff); } to { filter: drop-shadow(0 0 60px var(--accent)); } }

        .lb-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; }
        .perk-row { padding: 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #333; font-size: 0.8rem; }
        .unlocked { border-color: var(--accent); background: rgba(0, 242, 255, 0.1); }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="https://vgmsite.com/soundtracks/super-mario-kart-1992-snes/lytovmzf/12%20Koopa%20Beach.mp3" type="audio/mpeg"></audio>

    <div id="start-screen" class="overlay" style="display:flex;">
        <h1 style="font-size: 4rem; letter-spacing: 15px; color: var(--accent); margin: 0;">SHARK RNG</h1>
        <div class="login-box">
            <p>Enter details to Cloud Save/Load</p>
            <input type="text" id="user-input" placeholder="USERNAME" maxlength="12">
            <input type="password" id="pass-input" placeholder="PASSWORD">
            <button id="roll-btn" style="font-size:1.2rem; padding:15px 40px;" onclick="beginGame()">LOG IN & SYNC</button>
        </div>
    </div>

    <div id="reveal" onclick="closeReveal()">
        <div id="rev-icon">ðŸ¦ˆ</div>
        <h1 id="rev-name">---</h1>
        <h2 id="rev-odds">1 / 0</h2>
        <p style="opacity:0.5;">CLICK TO CONTINUE</p>
    </div>

    <div id="gallery-overlay" class="overlay">
        <h2>COLLECTION BOOK</h2>
        <div id="gallery-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(110px,1fr)); gap:10px; overflow-y:auto; flex:1;"></div>
        <button class="btn" onclick="closeOverlay('gallery-overlay')">BACK</button>
    </div>

    <div id="leaderboard-overlay" class="overlay">
        <h2>GLOBAL RANKINGS</h2>
        <div id="lb-list" style="flex:1; overflow-y:auto;"></div>
        <button class="btn" onclick="closeOverlay('leaderboard-overlay')">CLOSE</button>
    </div>

    <div id="main-game" style="display:none; height:100%; flex-direction:column; align-items:center; padding:20px;">
        <div class="side-panel" id="inventory-panel">
            <div style="padding:15px; background:rgba(0,242,255,0.1); font-weight:bold; text-align:center;">INVENTORY</div>
            <div id="inv-list" class="p-content"></div>
            <button class="btn" onclick="openGallery()">COLLECTION</button>
        </div>

        <div style="text-align:center;">
            <h2 id="luck-display" style="color:var(--accent); letter-spacing:3px;">LUCK: 1.0x</h2>
            <div id="shark-container">
                <div id="shark-engine">
                    <div class="shark-tail shark-part"></div>
                    <div class="shark-body shark-part"></div>
                    <div class="shark-fin shark-part"></div>
                </div>
                <button id="roll-btn" onclick="roll()">DROP BAIT</button>
                <div id="auto-status" style="color:#4caf50; font-weight:bold; display:none; margin-top:10px;">AUTO-ROLLING</div>
                <h3 id="roll-display">ROLLS: 0</h3>
                <button class="btn" onclick="openLeaderboard()">LEADERBOARD</button>
                <button class="btn" style="border-color:#ff3d00;" onclick="manualSave()">FORCE CLOUD SAVE</button>
            </div>
        </div>

        <div class="side-panel" id="perks-panel">
            <div style="padding:15px; background:rgba(0,242,255,0.1); font-weight:bold; text-align:center;">PERKS</div>
            <div id="perk-list" class="p-content"></div>
        </div>
    </div>

    <script>
        const PUBLIC_KEY = "6986e0d78f40bb1184d15e5a"; 
        const PRIVATE_KEY = "ghHwJKtK8EC6KQLpunpkagsjFToljWd06"; 

        const RARITIES = {
            COMMON: { w: 1, c: "#a0a0a0" }, UNCOMMON: { w: 5, c: "#4caf50" },
            RARE: { w: 25, c: "#2196f3" }, EPIC: { w: 100, c: "#9c27b0" },
            LEGENDARY: { w: 800, c: "#ffc107" }, ABYSSAL: { w: 4500, c: "#ff3d00" },
            SUNKEN: { w: 20000, c: "#00ffcc" }, PREHISTORIC: { w: 100000, c: "#ffffff" }
        };

        const ITEMS = [
            { n: "Tiny Guppy", i: "ðŸŸ", r: "COMMON" }, { n: "Old Boot", i: "ðŸ¥¾", r: "COMMON" },
            { n: "Baby Shark", i: "ðŸ¦ˆ", r: "UNCOMMON" }, { n: "Seaweed", i: "ðŸŒ¿", r: "UNCOMMON" },
            { n: "Crab King", i: "ðŸ¦€", r: "RARE" }, { n: "Electric Eel", i: "ðŸ", r: "RARE" }, { n: "Golden Hook", i: "ðŸª", r: "RARE" },
            { n: "Giant Squid", i: "ðŸ¦‘", r: "EPIC" }, { n: "Zombie Shark", i: "ðŸ§Ÿ", r: "EPIC" }, { n: "Treasure", i: "ðŸª™", r: "EPIC" },
            { n: "Great White", i: "ðŸ¦ˆ", r: "LEGENDARY" }, { n: "Cyber Shark", i: "ðŸ¤–", r: "LEGENDARY" }, { n: "Whale Shark", i: "ðŸ‹", r: "LEGENDARY" },
            { n: "Magma Shark", i: "ðŸŒ‹", r: "ABYSSAL" }, { n: "Ghost Shark", i: "ðŸ‘»", r: "ABYSSAL" }, { n: "Void Ray", i: "ðŸŒŒ", r: "ABYSSAL" },
            { n: "Poseidon Fork", i: "ðŸ”±", r: "SUNKEN" }, { n: "Atlantis Key", i: "ðŸ”‘", r: "SUNKEN" }, { n: "Sunken Anchor", i: "âš“", r: "SUNKEN" },
            { n: "Megalodon", i: "ðŸ¦´", r: "PREHISTORIC" }, { n: "Mosasaurus", i: "ðŸŠ", r: "PREHISTORIC" }, { n: "Ancient God", i: "ðŸŒ€", r: "PREHISTORIC" }
        ];

        const PERKS = [
            { n: 'Shiny Lure', req: 25, mult: 1.5 },
            { n: 'AUTO-ROLL', req: 50, auto: true },
            { n: 'Abyssal Light', req: 150, mult: 3.0 },
            { n: 'Double Bait', req: 300, mult: 5.0 },
            { n: 'Sonar Radar', req: 750, mult: 10.0 },
            { n: 'Abyssal Magnet', req: 2000, mult: 20.0 },
            { n: 'Oceanic God', req: 5000, mult: 35.0 },
            { n: 'Dev Blessing', req: 10000, mult: 50.0 }
        ];

        let state = { rolls: 0, inv: {}, luck: 1.0, name: "", pass: "", isAuto: false, rolling: false };

        // --- ENCODING LOGIC ---
        function encodeInv() { return btoa(JSON.stringify(state.inv)); }
        function decodeInv(str) { try { return JSON.parse(atob(str)); } catch(e) { return {}; } }

        async function beginGame() {
            const u = document.getElementById('user-input').value.trim();
            const p = document.getElementById('pass-input').value.trim();
            if(!u || !p) return alert("Enter Name & Password!");
            
            state.name = u.replace(/\s/g, ''); 
            state.pass = p;

            // Load from LocalStorage first (instant)
            const local = localStorage.getItem(`sharkRNG_${state.name}`);
            if(local) state = JSON.parse(local);

            // Fetch from Cloud (Dreamlo)
            try {
                const res = await fetch(`https://www.dreamlo.com/lb/${PUBLIC_KEY}/json`);
                const data = await res.json();
                if(data.dreamlo.leaderboard && data.dreamlo.leaderboard.entry) {
                    let entries = data.dreamlo.leaderboard.entry;
                    if(!Array.isArray(entries)) entries = [entries];
                    const myEntry = entries.find(x => x.name === state.name);
                    if(myEntry) {
                        state.rolls = parseInt(myEntry.score);
                        if(myEntry.text) state.inv = decodeInv(myEntry.text);
                    }
                }
            } catch(e) { console.log("New user or offline."); }

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-game').style.display = 'flex';
            document.getElementById('bg-music').play();
            checkPerks();
            updateUI();
        }

        function roll() {
            if (state.rolling) return;
            state.rolling = true;
            state.rolls++;
            document.getElementById('roll-btn').disabled = true;
            document.getElementById('shark-engine').classList.add('fast-swim');

            setTimeout(() => {
                let tier = "COMMON";
                const sorted = Object.keys(RARITIES).sort((a,b) => RARITIES[b].w - RARITIES[a].w);
                for (let r of sorted) {
                    if (Math.random() < (1 / (r === "COMMON" ? 1 : RARITIES[r].w / state.luck))) { tier = r; break; }
                }

                const pool = ITEMS.filter(i => i.r === tier);
                const item = pool[Math.floor(Math.random() * pool.length)];
                state.inv[item.n] = (state.inv[item.n] || 0) + 1;

                if (state.rolls % 15 === 0) manualSave();
                checkPerks();
                updateUI();

                if (tier === "COMMON" && state.isAuto) finishRoll();
                else showReveal(item);
            }, 600);
        }

        function manualSave() {
            localStorage.setItem(`sharkRNG_${state.name}`, JSON.stringify(state));
            const invData = encodeInv();
            // Dreamlo trick: /add/NAME/SCORE/SECONDS/TEXT
            fetch(`https://www.dreamlo.com/lb/${PRIVATE_KEY}/add/${state.name}/${state.rolls}/0/${invData}`);
        }

        function showReveal(item) {
            const icon = document.getElementById('rev-icon');
            icon.innerText = item.i;
            icon.className = (item.r === "PREHISTORIC") ? "prehistoric-glow" : "";
            document.getElementById('rev-name').innerText = item.n;
            document.getElementById('rev-name').style.color = RARITIES[item.r].c;
            document.getElementById('rev-odds').innerText = `1 / ${RARITIES[item.r].w.toLocaleString()}`;
            document.getElementById('reveal').style.display = 'flex';
            if (state.isAuto) setTimeout(closeReveal, 1000);
        }

        function closeReveal() { document.getElementById('reveal').style.display = 'none'; finishRoll(); }

        function finishRoll() {
            state.rolling = false;
            document.getElementById('shark-engine').classList.remove('fast-swim');
            document.getElementById('roll-btn').disabled = false;
            if (state.isAuto) setTimeout(roll, 300);
        }

        function checkPerks() {
            let bestMult = 1.0;
            PERKS.forEach(p => { 
                if (state.rolls >= p.req) {
                    if (p.mult) bestMult = p.mult;
                    if (p.auto) state.isAuto = true;
                }
            });
            state.luck = bestMult;
            if (state.isAuto) document.getElementById('auto-status').style.display = 'block';
        }

        function updateUI() {
            document.getElementById('roll-display').innerText = `ROLLS: ${state.rolls}`;
            document.getElementById('luck-display').innerText = `LUCK: ${state.luck.toFixed(1)}x`;
            const inv = document.getElementById('inv-list');
            inv.innerHTML = Object.entries(state.inv).reverse().slice(0, 12).map(([n, c]) => {
                const it = ITEMS.find(x => x.n === n);
                if(!it) return "";
                return `<div style="color:${RARITIES[it.r].c}">${it.i} ${n} x${c}</div>`;
            }).join('');

            const pl = document.getElementById('perk-list');
            pl.innerHTML = PERKS.map(p => `
                <div class="perk-row ${state.rolls >= p.req ? 'unlocked' : ''}">
                    <b>${p.n}</b> (${p.req} Rolls)
                </div>
            `).join('');
        }

        function openGallery() {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = ITEMS.map(it => {
                const owned = state.inv[it.n] > 0;
                return `<div class="g-card ${owned ? '' : 'locked'}">
                    <span style="font-size:1.5rem">${it.i}</span><br>
                    <small style="color:${owned ? RARITIES[it.r].c : '#444'}">${it.n}</small>
                </div>`;
            }).join('');
            document.getElementById('gallery-overlay').style.display = 'flex';
        }

        function openLeaderboard() {
            document.getElementById('leaderboard-overlay').style.display = 'flex';
            fetch(`https://www.dreamlo.com/lb/${PUBLIC_KEY}/json`).then(r => r.json()).then(d => {
                let e = d.dreamlo.leaderboard.entry;
                if(!Array.isArray(e)) e = [e];
                document.getElementById('lb-list').innerHTML = e.map(i => `<div class="lb-row"><span>${i.name}</span><span>${i.score}</span></div>`).join('');
            });
        }

        function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
