<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHARK RNG | ABYSSAL HUNTER</title>
    <style>
        :root {
            --bg: #01060f; --accent: #00f2ff; --panel: rgba(0, 15, 30, 0.95);
            --c-COMMON: #a0a0a0; --c-UNCOMMON: #4caf50; --c-RARE: #2196f3;
            --c-EPIC: #9c27b0; --c-LEGENDARY: #ffc107; --c-ABYSSAL: #ff3d00;
            --c-SUNKEN: #00ffcc; --c-PREHISTORIC: #ffffff;
        }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; user-select: none; }
        
        /* --- SHARK ENGINE --- */
        #shark-container { margin: 20px auto; width: 300px; height: 150px; position: relative; }
        #shark-engine { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; animation: global-swim 4s infinite ease-in-out; }
        .shark-part { position: absolute; background: var(--accent); box-shadow: 0 0 20px var(--accent); transition: 0.3s; }
        .shark-body { width: 130px; height: 55px; border-radius: 50% 50% 40% 40%; left: 85px; }
        .shark-fin { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 45px solid var(--accent); top: 15px; left: 125px; }
        .shark-tail { width: 0; height: 0; border-top: 30px solid transparent; border-bottom: 30px solid transparent; border-left: 45px solid var(--accent); left: 50px; animation: tail-wag 0.6s infinite ease-in-out; }
        
        @keyframes global-swim { 0%, 100% { transform: translateX(-30px); } 50% { transform: translateX(30px); } }
        @keyframes tail-wag { 0%, 100% { transform: rotateY(0deg); } 50% { transform: rotateY(50deg); } }
        .frenzy { animation-duration: 0.2s !important; }

        /* --- UI OVERLAYS --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .id-card { width: 320px; background: linear-gradient(145deg, #001a2e, #000); border: 2px solid var(--accent); border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 0 40px rgba(0, 242, 255, 0.4); }
        
        /* --- MAIN GAME --- */
        .side-panel { position: absolute; top: 20px; bottom: 20px; width: 250px; background: var(--panel); border: 1px solid rgba(0, 242, 255, 0.2); border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        #inventory-panel { left: 20px; } #perks-panel { right: 20px; }
        .p-content { flex: 1; overflow-y: auto; padding: 15px; }
        
        #roll-btn { padding: 20px 50px; font-size: 1.8rem; border-radius: 50px; background: #fff; color: #000; font-weight: 900; border: none; cursor: pointer; transition: 0.2s; box-shadow: 0 0 30px var(--accent); }
        #roll-btn:active { transform: scale(0.9); }
        
        .btn { padding: 8px 15px; background: transparent; border: 1px solid var(--accent); color: white; border-radius: 5px; cursor: pointer; margin: 5px; font-weight: bold; }
        .g-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; border: 1px solid #333; }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="https://ia804500.us.archive.org/27/items/super-mario-kart-koopa-beach-music/Super%20Mario%20Kart%20-%20Koopa%20Beach.mp3" type="audio/mpeg"></audio>

    <div id="start-screen" class="overlay" style="display:flex;">
        <h1 style="color:var(--accent); font-size: 3rem; letter-spacing: 10px;">SHARK RNG</h1>
        <div class="id-card">
            <input type="text" id="user-input" placeholder="USERNAME" maxlength="12" style="width:80%; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--accent); border-radius:5px; text-align:center;">
            <input type="password" id="pass-input" placeholder="PASSWORD" style="width:80%; padding:10px; margin-bottom:10px; background:#000; color:#fff; border:1px solid var(--accent); border-radius:5px; text-align:center;">
            <button class="btn" style="width:85%; padding:15px;" onclick="beginGame()">LOG IN & SYNC</button>
        </div>
        <p style="font-size:0.7rem; margin-top:10px; color:#555;">Music will start after login</p>
    </div>

    <div id="profile-overlay" class="overlay">
        <div class="id-card">
            <div id="id-pfp" style="font-size:4rem; margin-bottom:10px;">üêô</div>
            <h2 id="id-name" style="margin:0;">---</h2>
            <p id="id-number" style="color:var(--accent); font-family:monospace; margin-top:0;">#0000</p>
            <div style="display:flex; justify-content:space-around; border-top:1px solid #222; padding-top:15px;">
                <div><b>ROLLS</b><br><span id="id-rolls">0</span></div>
                <div><b>LUCK</b><br><span id="id-luck">1.0x</span></div>
            </div>
            <button class="btn" style="margin-top:20px; width:100%;" onclick="closeOverlay('profile-overlay')">RETURN</button>
        </div>
    </div>

    <div id="main-game" style="display:none; height:100%; flex-direction:column; align-items:center; justify-content:center;">
        <div class="side-panel" id="inventory-panel">
            <div style="padding:15px; text-align:center; background:rgba(0,242,255,0.1); font-weight:bold;">INVENTORY</div>
            <div id="inv-list" class="p-content"></div>
            <button class="btn" onclick="openGallery()">COLLECTION BOOK</button>
        </div>

        <div style="text-align:center;">
            <h2 id="luck-stat" style="color:var(--accent); letter-spacing:3px;">LUCK: 1.0x</h2>
            <div id="shark-container">
                <div id="shark-engine">
                    <div class="shark-tail shark-part"></div>
                    <div class="shark-body shark-part"></div>
                    <div class="shark-fin shark-part"></div>
                </div>
            </div>
            <button id="roll-btn" onclick="roll()">DROP BAIT</button>
            <h1 id="roll-stat" style="margin-top:20px;">ROLLS: 0</h1>
            <div>
                <button class="btn" onclick="openProfile()">MY PROFILE</button>
                <button class="btn" onclick="manualSave()" id="save-btn">CLOUD SAVE</button>
            </div>
        </div>

        <div class="side-panel" id="perks-panel">
            <div style="padding:15px; text-align:center; background:rgba(0,242,255,0.1); font-weight:bold;">PERKS</div>
            <div id="perk-list" class="p-content"></div>
        </div>
    </div>

    <script>
        const PUBLIC_KEY = "6986e0d78f40bb1184d15e5a";
        const PRIVATE_KEY = "ghHwJKtK8EC6KQLpunpkagsjFToljWd06";
        const EMOJIS = ["üêô","üê°","ü¶ë","ü¶à","üê¨","üêã","ü¶Ä","üêö","üåä","üßú‚Äç‚ôÇÔ∏è","üî±","üê†"];

        const RARITIES = {
            COMMON: { w: 1, c: "#a0a0a0" }, UNCOMMON: { w: 5, c: "#4caf50" },
            RARE: { w: 25, c: "#2196f3" }, EPIC: { w: 100, c: "#9c27b0" },
            LEGENDARY: { w: 800, c: "#ffc107" }, ABYSSAL: { w: 4500, c: "#ff3d00" },
            SUNKEN: { w: 20000, c: "#00ffcc" }, PREHISTORIC: { w: 100000, c: "#ffffff" }
        };

        const ITEMS = [
            { n: "Tiny Guppy", i: "üêü", r: "COMMON" }, { n: "Old Boot", i: "ü•æ", r: "COMMON" },
            { n: "Baby Shark", i: "ü¶à", r: "UNCOMMON" }, { n: "Seaweed", i: "üåø", r: "UNCOMMON" },
            { n: "Crab King", i: "ü¶Ä", r: "RARE" }, { n: "Electric Eel", i: "üêç", r: "RARE" },
            { n: "Giant Squid", i: "ü¶ë", r: "EPIC" }, { n: "Zombie Shark", i: "üßü", r: "EPIC" },
            { n: "Great White", i: "ü¶à", r: "LEGENDARY" }, { n: "Whale Shark", i: "üêã", r: "LEGENDARY" },
            { n: "Magma Shark", i: "üåã", r: "ABYSSAL" }, { n: "Ghost Shark", i: "üëª", r: "ABYSSAL" },
            { n: "Poseidon Fork", i: "üî±", r: "SUNKEN" }, { n: "Megalodon", i: "ü¶¥", r: "PREHISTORIC" }
        ];

        const PERKS = [
            { n: 'Shiny Lure', req: 25, mult: 1.5 }, { n: 'AUTO-ROLL', req: 50, auto: true },
            { n: 'Abyssal Light', req: 150, mult: 3.0 }, { n: 'Oceanic God', req: 1000, mult: 15.0 }
        ];

        let state = { rolls: 0, inv: {}, luck: 1.0, name: "", pfp: "üêô", idNum: "0000", isAuto: false, rolling: false };

        async function beginGame() {
            state.name = document.getElementById('user-input').value.trim().replace(/\s/g, '');
            if(!state.name) return alert("Enter Name!");

            try {
                const res = await fetch(`https://www.dreamlo.com/lb/${PUBLIC_KEY}/json`);
                const data = await res.json();
                const entries = data.dreamlo.leaderboard.entry;
                const myData = (Array.isArray(entries) ? entries : [entries]).find(x => x.name === state.name);
                
                if(myData) {
                    const decoded = JSON.parse(atob(myData.text));
                    state.rolls = parseInt(myData.score);
                    state.inv = decoded.inv;
                    state.pfp = decoded.pfp;
                    state.idNum = decoded.idNum;
                } else {
                    state.pfp = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
                    state.idNum = Math.floor(1000 + Math.random()*9000);
                }
            } catch(e) {
                state.pfp = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
                state.idNum = Math.floor(1000 + Math.random()*9000);
            }

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('main-game').style.display = 'flex';
            document.getElementById('bg-music').play().catch(() => console.log("Music blocked by browser"));
            updateUI();
        }

        function roll() {
            if(state.rolling) return;
            state.rolling = true;
            state.rolls++;
            
            const engine = document.getElementById('shark-engine');
            engine.classList.add('frenzy');

            setTimeout(() => {
                let tier = "COMMON";
                const sorted = Object.keys(RARITIES).sort((a,b) => RARITIES[b].w - RARITIES[a].w);
                for (let r of sorted) {
                    if (Math.random() < (1 / (r === "COMMON" ? 1 : RARITIES[r].w / state.luck))) { tier = r; break; }
                }

                const pool = ITEMS.filter(i => i.r === tier);
                const item = pool[Math.floor(Math.random() * pool.length)];
                state.inv[item.n] = (state.inv[item.n] || 0) + 1;

                engine.classList.remove('frenzy');
                updateUI();
                state.rolling = false;
                if(state.isAuto) setTimeout(roll, 500);
            }, 400);
        }

        function manualSave() {
            const btn = document.getElementById('save-btn');
            btn.innerText = "...";
            const dataToSave = btoa(JSON.stringify({inv: state.inv, pfp: state.pfp, idNum: state.idNum}));
            fetch(`https://www.dreamlo.com/lb/${PRIVATE_KEY}/add/${state.name}/${state.rolls}/0/${dataToSave}`)
                .then(() => { btn.innerText = "SAVED!"; setTimeout(()=>btn.innerText="CLOUD SAVE", 2000); });
        }

        function updateUI() {
            document.getElementById('roll-stat').innerText = `ROLLS: ${state.rolls}`;
            document.getElementById('luck-stat').innerText = `LUCK: ${state.luck.toFixed(1)}x`;
            
            let mult = 1.0;
            PERKS.forEach(p => { if(state.rolls >= p.req) { mult = p.mult || mult; if(p.auto) state.isAuto = true; } });
            state.luck = mult;

            document.getElementById('inv-list').innerHTML = Object.entries(state.inv).reverse().slice(0,10).map(([n,c])=>{
                const it = ITEMS.find(x=>x.n===n);
                return `<div style="color:${RARITIES[it.r].c}">${it.i} ${n} x${c}</div>`;
            }).join('');

            document.getElementById('perk-list').innerHTML = PERKS.map(p=>`<div style="opacity:${state.rolls>=p.req?1:0.3}">${p.n} (${p.req})</div>`).join('');
        }

        function openProfile() {
            document.getElementById('id-name').innerText = state.name;
            document.getElementById('id-pfp').innerText = state.pfp;
            document.getElementById('id-number').innerText = "#" + state.idNum;
            document.getElementById('id-rolls').innerText = state.rolls;
            document.getElementById('id-luck').innerText = state.luck.toFixed(1) + "x";
            document.getElementById('profile-overlay').style.display = 'flex';
        }

        function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
